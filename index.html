<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>IMPOSSIBLE DODGE</title>
    <style>
        body { margin: 0; padding: 0; overflow: hidden; touch-action: none; 
               background: #000; font-family: Arial; user-select: none; }
        #gameCanvas { display: block; background: #000; margin: 0 auto; }
        #controls {
            position: fixed; bottom: 20px; 
            left: 50%; transform: translateX(-50%);
            display: flex; flex-direction: column;
            align-items: center;
            gap: 5px;
        }
        .row {
            display: flex;
            justify-content: center;
            gap: 5px;
        }
        .btn {
            width: 70px; height: 70px; border-radius: 50%;
            background: rgba(255,0,0,0.3); color: white;
            display: flex; justify-content: center; align-items: center;
            font-weight: bold; font-size: 24px; touch-action: manipulation;
        }
        #leftBtn, #rightBtn {
            margin: 0 5px; /* Сближаем кнопки влево/вправо */
        }
        #score {
            position: fixed; top: 10px; left: 10px;
            color: red; font-size: 16px; text-shadow: 0 0 3px #f00;
        }
        #gameOver {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.9); display: none; flex-direction: column;
            justify-content: center; align-items: center; color: red;
            font-size: 24px; text-align: center; z-index: 100;
        }
        #restartBtn {
            margin-top: 20px; padding: 10px 20px; font-size: 18px;
            background: #f00; color: white; border: none;
            border-radius: 5px; cursor: pointer;
        }
    </style>
</head>
<body>
    <div id="score">Time: 0.00с</div>
    <canvas id="gameCanvas"></canvas>
    
    <div id="controls">
        <div class="row">
            <div class="btn" id="upBtn">↑</div>
        </div>
        <div class="row">
            <div class="btn" id="leftBtn">←</div>
            <div class="btn" id="downBtn">↓</div>
            <div class="btn" id="rightBtn">→</div>
        </div>
    </div>
    
    <div id="gameOver">
        <h1 style="font-size: 30px;">Death</h1>
        <p id="finalTime">Time: 0.00с</p>
        <button id="restartBtn">Try Again</button>
    </div>

    <script>
        // ===== НАСТРОЙКИ АДА =====
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        let startTime = 0, deathTime = 0;
        let bullets = [], lasers = [], enemies = [];
        let animationId = null, gameActive = false;
        
        // Размеры экрана
        function resizeCanvas() {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
        }
        resizeCanvas();
        window.addEventListener('resize', resizeCanvas);
        
        // ===== ИГРОК =====
        const player = {
            x: canvas.width/2, y: canvas.height/2, size: 10,
            speed: 8, color: '#00f',
            draw() {
                ctx.fillStyle = this.color;
                ctx.fillRect(this.x-this.size/2, this.y-this.size/2, this.size, this.size);
            }
        };
        
        // ===== УПРАВЛЕНИЕ =====
        let keys = { up: false, down: false, left: false, right: false };
        
        // Назначаем кнопки
        ['up','down','left','right'].forEach(dir => {
            const btn = document.getElementById(dir+'Btn');
            btn.addEventListener('touchstart', (e) => { e.preventDefault(); keys[dir] = true; }, {passive: false});
            btn.addEventListener('touchend', (e) => { e.preventDefault(); keys[dir] = false; }, {passive: false});
        });
        
        // Для ПК
        window.addEventListener('keydown', (e) => {
            if (e.key === 'ArrowUp') keys.up = true;
            if (e.key === 'ArrowDown') keys.down = true;
            if (e.key === 'ArrowLeft') keys.left = true;
            if (e.key === 'ArrowRight') keys.right = true;
        });
        window.addEventListener('keyup', (e) => {
            if (e.key === 'ArrowUp') keys.up = false;
            if (e.key === 'ArrowDown') keys.down = false;
            if (e.key === 'ArrowLeft') keys.left = false;
            if (e.key === 'ArrowRight') keys.right = false;
        });
        
        // ===== АДСКИЕ ОБЪЕКТЫ =====
        function spawnBullet() {
            const side = Math.floor(Math.random() * 4);
            let x, y, vx, vy;
            
            switch(side) {
                case 0: x=Math.random()*canvas.width; y=0; vx=0; vy=10; break;
                case 1: x=canvas.width; y=Math.random()*canvas.height; vx=-10; vy=0; break;
                case 2: x=Math.random()*canvas.width; y=canvas.height; vx=0; vy=-10; break;
                case 3: x=0; y=Math.random()*canvas.height; vx=10; vy=0; break;
            }
            
            bullets.push({ x, y, vx, vy, size:8, color:'#f00' });
        }
        
        function spawnLaser() {
            const isHorizontal = Math.random() < 0.5;
            lasers.push({
                x: isHorizontal ? 0 : Math.random()*canvas.width,
                y: isHorizontal ? Math.random()*canvas.height : 0,
                width: isHorizontal ? canvas.width : 15,
                height: isHorizontal ? 15 : canvas.height,
                color: '#f00',
                activeTime: 20,
                timer: 0
            });
        }
        
        function spawnBigEnemy() {
            const side = Math.floor(Math.random() * 4);
            let x, y, vx, vy;
            
            switch(side) {
                case 0: x=Math.random()*canvas.width; y=0; vx=0; vy=3; break;
                case 1: x=canvas.width; y=Math.random()*canvas.height; vx=-3; vy=0; break;
                case 2: x=Math.random()*canvas.width; y=canvas.height; vx=0; vy=-3; break;
                case 3: x=0; y=Math.random()*canvas.height; vx=3; vy=0; break;
            }
            
            enemies.push({ 
                x, y, vx, vy, 
                size: 30, 
                color: '#f00',
                health: 3
            });
        }
        
        // ===== ЯДРО ИГРЫ =====
        function gameLoop(timestamp) {
            if (!startTime) startTime = timestamp;
            const elapsed = (timestamp - startTime) / 1000;
            
            if (gameActive) {
                // Очистка
                ctx.fillStyle = 'rgba(0,0,0,0.2)';
                ctx.fillRect(0, 0, canvas.width, canvas.height);
                
                // Движение игрока
                if (keys.up) player.y -= player.speed;
                if (keys.down) player.y += player.speed;
                if (keys.left) player.x -= player.speed;
                if (keys.right) player.x += player.speed;
                
                // Границы
                player.x = Math.max(player.size/2, Math.min(canvas.width-player.size/2, player.x));
                player.y = Math.max(player.size/2, Math.min(canvas.height-player.size/2, player.y));
                
                player.draw();
                
                // Спавн объектов
                if (Math.random() < 0.3) spawnBullet(); // Пули постоянно
                if (elapsed % 0.5 < 0.016) spawnLaser(); // Лазеры каждые 0.5с
                if (elapsed % 2 < 0.016) spawnBigEnemy(); // Крупные враги каждые 2 секунды
                
                // Обновление пуль
                bullets.forEach((bullet, i) => {
                    bullet.x += bullet.vx;
                    bullet.y += bullet.vy;
                    ctx.fillStyle = bullet.color;
                    ctx.fillRect(bullet.x-bullet.size/2, bullet.y-bullet.size/2, bullet.size, bullet.size);
                    
                    // Столкновение
                    if (Math.abs(player.x - bullet.x) < (player.size + bullet.size)/2 && 
                        Math.abs(player.y - bullet.y) < (player.size + bullet.size)/2) {
                        gameActive = false;
                        deathTime = elapsed;
                    }
                    
                    // Удаление
                    if (bullet.x < -100 || bullet.x > canvas.width+100 || 
                        bullet.y < -100 || bullet.y > canvas.height+100) {
                        bullets.splice(i, 1);
                    }
                });
                
                // Обновление лазеров
                lasers.forEach((laser, i) => {
                    laser.timer++;
                    if (laser.timer < laser.activeTime) {
                        ctx.fillStyle = laser.color;
                        ctx.fillRect(laser.x, laser.y, laser.width, laser.height);
                        
                        // Столкновение
                        let hit = false;
                        if (laser.width > laser.height) { // Горизонтальный
                            hit = (player.y + player.size/2 > laser.y && 
                                  player.y - player.size/2 < laser.y + laser.height);
                        } else { // Вертикальный
                            hit = (player.x + player.size/2 > laser.x && 
                                  player.x - player.size/2 < laser.x + laser.width);
                        }
                        if (hit) {
                            gameActive = false;
                            deathTime = elapsed;
                        }
                    }
                    if (laser.timer > laser.activeTime*2) {
                        lasers.splice(i, 1);
                    }
                });
                
                // Обновление крупных врагов
                enemies.forEach((enemy, i) => {
                    enemy.x += enemy.vx;
                    enemy.y += enemy.vy;
                    
                    ctx.fillStyle = enemy.color;
                    ctx.fillRect(enemy.x-enemy.size/2, enemy.y-enemy.size/2, enemy.size, enemy.size);
                    
                    // Столкновение с игроком
                    if (Math.abs(player.x - enemy.x) < (player.size + enemy.size)/2 && 
                        Math.abs(player.y - enemy.y) < (player.size + enemy.size)/2) {
                        gameActive = false;
                        deathTime = elapsed;
                    }
                    
                    // Удаление
                    if (enemy.x < -100 || enemy.x > canvas.width+100 || 
                        enemy.y < -100 || enemy.y > canvas.height+100) {
                        enemies.splice(i, 1);
                    }
                });
                
                // Время
                document.getElementById('score').textContent = `Time: ${elapsed.toFixed(2)}с`;
                
                animationId = requestAnimationFrame(gameLoop);
            } else {
                document.getElementById('finalTime').textContent = `Time: ${deathTime.toFixed(2)}с`;
                document.getElementById('gameOver').style.display = 'flex';
            }
        }
        
        // ===== ЗАПУСК =====
        function startGame() {
            cancelAnimationFrame(animationId);
            startTime = 0;
            bullets = [];
            lasers = [];
            enemies = [];
            player.x = canvas.width/2;
            player.y = canvas.height/2;
            gameActive = true;
            document.getElementById('gameOver').style.display = 'none';
            resizeCanvas();
            animationId = requestAnimationFrame(gameLoop);
        }
        
        document.getElementById('restartBtn').addEventListener('click', startGame);
        startGame();
    </script>
</body>
</html>